(ns kixi.lapita.plot-test
  (:require [kixi.lapita.plot :refer :all]
            [clojure.test :refer :all]
            [clojure.core.matrix.dataset :as ds]))

(def test-data
  (ds/dataset [{:col-1 2000 :col-2 43}
               {:col-1 2001 :col-2 47}
               {:col-1 2002 :col-2 62}
               {:col-1 2003 :col-2 43}
               {:col-1 2004 :col-2 54}
               {:col-1 2005 :col-2 57}
               {:col-1 2006 :col-2 48}
               {:col-1 2007 :col-2 58}
               {:col-1 2008 :col-2 65}
               {:col-1 2009 :col-2 68}]))

(deftest bar-chart-test
  (testing "Creation of a basic bar chart"
    (is (= (bar-chart test-data :col-1 :col-2 "data/test-chart.svg")
           {:plot [:g nil [:g {:stroke "#ccc", :stroke-dasharray "1 1"}
                           '([:line {:x1 "50.00", :y1 "280.00", :x2 "50.00", :y2 "20.00"}]
                             [:line {:x1 "98.18", :y1 "280.00", :x2 "98.18", :y2 "20.00"}]
                             [:line {:x1 "146.36", :y1 "280.00", :x2 "146.36", :y2 "20.00"}]
                             [:line {:x1 "194.55", :y1 "280.00", :x2 "194.55", :y2 "20.00"}]
                             [:line {:x1 "242.73", :y1 "280.00", :x2 "242.73", :y2 "20.00"}]
                             [:line {:x1 "290.91", :y1 "280.00", :x2 "290.91", :y2 "20.00"}]
                             [:line {:x1 "339.09", :y1 "280.00", :x2 "339.09", :y2 "20.00"}]
                             [:line {:x1 "387.27", :y1 "280.00", :x2 "387.27", :y2 "20.00"}]
                             [:line {:x1 "435.45", :y1 "280.00", :x2 "435.45", :y2 "20.00"}]
                             [:line {:x1 "483.64", :y1 "280.00", :x2 "483.64", :y2 "20.00"}]
                             [:line {:x1 "531.82", :y1 "280.00", :x2 "531.82", :y2 "20.00"}]
                             [:line {:x1 "580.00", :y1 "280.00", :x2 "580.00", :y2 "20.00"}])
                           '([:line {:x1 "50.00", :y1 "262.19", :x2 "580.00", :y2 "262.19"}]
                             [:line {:x1 "50.00", :y1 "226.58", :x2 "580.00", :y2 "226.58"}]
                             [:line {:x1 "50.00", :y1 "190.96", :x2 "580.00", :y2 "190.96"}]
                             [:line {:x1 "50.00", :y1 "155.34", :x2 "580.00", :y2 "155.34"}]
                             [:line {:x1 "50.00", :y1 "119.73", :x2 "580.00", :y2 "119.73"}]
                             [:line {:x1 "50.00", :y1 "84.11", :x2 "580.00", :y2 "84.11"}]
                             [:line {:x1 "50.00", :y1 "48.49", :x2 "580.00", :y2 "48.49"}]
                             [:line {:x1 "50.00", :y1 "280.00", :x2 "580.00", :y2 "280.00"}]
                             [:line {:x1 "50.00", :y1 "244.38", :x2 "580.00", :y2 "244.38"}]
                             [:line {:x1 "50.00", :y1 "208.77", :x2 "580.00", :y2 "208.77"}]
                             [:line {:x1 "50.00", :y1 "173.15", :x2 "580.00", :y2 "173.15"}]
                             [:line {:x1 "50.00", :y1 "137.53", :x2 "580.00", :y2 "137.53"}]
                             [:line {:x1 "50.00", :y1 "101.92", :x2 "580.00", :y2 "101.92"}]
                             [:line {:x1 "50.00", :y1 "66.30", :x2 "580.00", :y2 "66.30"}]
                             [:line {:x1 "50.00", :y1 "30.68", :x2 "580.00", :y2 "30.68"}])]
                   '([:g {:stroke "#3D325A", :stroke-width "19px"}
                      [:line {:x1 "88.18", :y1 "126.85", :x2 "88.18", :y2 "280.00"}]
                      [:line {:x1 "136.36", :y1 "112.60", :x2 "136.36", :y2 "280.00"}]
                      [:line {:x1 "184.55", :y1 "59.18", :x2 "184.55", :y2 "280.00"}]
                      [:line {:x1 "232.73", :y1 "126.85", :x2 "232.73", :y2 "280.00"}]
                      [:line {:x1 "280.91", :y1 "87.67", :x2 "280.91", :y2 "280.00"}]
                      [:line {:x1 "329.09", :y1 "76.99", :x2 "329.09", :y2 "280.00"}]
                      [:line {:x1 "377.27", :y1 "109.04", :x2 "377.27", :y2 "280.00"}]
                      [:line {:x1 "425.45", :y1 "73.42", :x2 "425.45", :y2 "280.00"}]
                      [:line {:x1 "473.64", :y1 "48.49", :x2 "473.64", :y2 "280.00"}]
                      [:line {:x1 "521.82", :y1 "37.81", :x2 "521.82", :y2 "280.00"}]])
                   [:g {:stroke "black"}
                    '([:line {:x1 "50.00", :y1 "280.00", :x2 "50.00", :y2 "290.00"}]
                      [:line {:x1 "98.18", :y1 "280.00", :x2 "98.18", :y2 "290.00"}]
                      [:line {:x1 "146.36", :y1 "280.00", :x2 "146.36", :y2 "290.00"}]
                      [:line {:x1 "194.55", :y1 "280.00", :x2 "194.55", :y2 "290.00"}]
                      [:line {:x1 "242.73", :y1 "280.00", :x2 "242.73", :y2 "290.00"}]
                      [:line {:x1 "290.91", :y1 "280.00", :x2 "290.91", :y2 "290.00"}]
                      [:line {:x1 "339.09", :y1 "280.00", :x2 "339.09", :y2 "290.00"}]
                      [:line {:x1 "387.27", :y1 "280.00", :x2 "387.27", :y2 "290.00"}]
                      [:line {:x1 "435.45", :y1 "280.00", :x2 "435.45", :y2 "290.00"}]
                      [:line {:x1 "483.64", :y1 "280.00", :x2 "483.64", :y2 "290.00"}]
                      [:line {:x1 "531.82", :y1 "280.00", :x2 "531.82", :y2 "290.00"}]
                      [:line {:x1 "580.00", :y1 "280.00", :x2 "580.00", :y2 "290.00"}]) '()
                    [:g {:stroke "none", :fill "black", :font-family "Arial, sans-serif",
                         :font-size 10, :text-anchor "middle"}
                     [:text {:x "50.00", :y "300.00"} 1999] [:text {:x "98.18", :y "300.00"} 2000]
                     [:text {:x "146.36", :y "300.00"} 2001] [:text {:x "194.55", :y "300.00"} 2002]
                     [:text {:x "242.73", :y "300.00"} 2003] [:text {:x "290.91", :y "300.00"} 2004]
                     [:text {:x "339.09", :y "300.00"} 2005] [:text {:x "387.27", :y "300.00"} 2006]
                     [:text {:x "435.45", :y "300.00"} 2007] [:text {:x "483.64", :y "300.00"} 2008]
                     [:text {:x "531.82", :y "300.00"} 2009] [:text {:x "580.00", :y "300.00"} 2010]]
                    [:line {:x1 "50.00", :y1 "280.00", :x2 "580.00", :y2 "280.00"}]]
                   [:g {:stroke "black"}
                    '([:line {:x1 "50.00", :y1 "280.00", :x2 "40.00", :y2 "280.00"}]
                      [:line {:x1 "50.00", :y1 "244.38", :x2 "40.00", :y2 "244.38"}]
                      [:line {:x1 "50.00", :y1 "208.77", :x2 "40.00", :y2 "208.77"}]
                      [:line {:x1 "50.00", :y1 "173.15", :x2 "40.00", :y2 "173.15"}]
                      [:line {:x1 "50.00", :y1 "137.53", :x2 "40.00", :y2 "137.53"}]
                      [:line {:x1 "50.00", :y1 "101.92", :x2 "40.00", :y2 "101.92"}]
                      [:line {:x1 "50.00", :y1 "66.30", :x2 "40.00", :y2 "66.30"}]
                      [:line {:x1 "50.00", :y1 "30.68", :x2 "40.00", :y2 "30.68"}])
                    '([:line {:x1 "50.00", :y1 "262.19", :x2 "45.00", :y2 "262.19"}]
                      [:line {:x1 "50.00", :y1 "226.58", :x2 "45.00", :y2 "226.58"}]
                      [:line {:x1 "50.00", :y1 "190.96", :x2 "45.00", :y2 "190.96"}]
                      [:line {:x1 "50.00", :y1 "155.34", :x2 "45.00", :y2 "155.34"}]
                      [:line {:x1 "50.00", :y1 "119.73", :x2 "45.00", :y2 "119.73"}]
                      [:line {:x1 "50.00", :y1 "84.11", :x2 "45.00", :y2 "84.11"}]
                      [:line {:x1 "50.00", :y1 "48.49", :x2 "45.00", :y2 "48.49"}])
                    [:g {:stroke "none", :fill "black", :font-family "Arial, sans-serif",
                         :font-size 10, :text-anchor "end"} [:text {:x "35.00", :y "280.00"} "0.00"]
                     [:text {:x "35.00", :y "244.38"} "10.00"]
                     [:text {:x "35.00", :y "208.77"} "20.00"]
                     [:text {:x "35.00", :y "173.15"} "30.00"]
                     [:text {:x "35.00", :y "137.53"} "40.00"]
                     [:text {:x "35.00", :y "101.92"} "50.00"]
                     [:text {:x "35.00", :y "66.30"} "60.00"]
                     [:text {:x "35.00", :y "30.68"} "70.00"]]
                    [:line {:x1 "50.00", :y1 "280.00", :x2 "50.00", :y2 "20.00"}]]],
            :width 600, :height 320}))))
