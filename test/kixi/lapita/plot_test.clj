(ns kixi.lapita.plot-test
  (:require [kixi.lapita.plot :refer :all]
            [clojure.test :refer :all]
            [clojure.core.matrix.dataset :as ds]))

(def test-data
  (ds/dataset [{:col-1 2000 :col-2 43}
               {:col-1 2001 :col-2 47}
               {:col-1 2002 :col-2 62}
               {:col-1 2003 :col-2 43}
               {:col-1 2004 :col-2 54}
               {:col-1 2005 :col-2 57}]))

(def test-data2
  (ds/dataset [{:col-1 -10 :col-2 43}
               {:col-1 -5 :col-2 47}
               {:col-1 0 :col-2 62}
               {:col-1 5 :col-2 43}
               {:col-1 10 :col-2 54}
               {:col-1 15 :col-2 57}]))

(def test-data3
  (ds/dataset [{:col-1 33 :col-2 -15}
               {:col-1 47 :col-2 -10}
               {:col-1 52 :col-2 -5}
               {:col-1 58 :col-2 5}
               {:col-1 61 :col-2 10}
               {:col-1 67 :col-2 15}]))

(def test-data4
  (ds/dataset [{:col-1 1 :col-2 -15}
               {:col-1 2 :col-2 -10}
               {:col-1 3 :col-2 -5}
               {:col-1 4 :col-2 5}
               {:col-1 5 :col-2 10}
               {:col-1 6 :col-2 15}]))

(deftest bar-chart-test
  (testing "Creation of a basic bar chart"
    (is (= (bar-chart test-data :col-1 :col-2)
           {:plot [:g nil [:g {:stroke "#ccc", :stroke-dasharray "1 1"} '([:line {:x1 "50.00", :y1 "280.00", :x2 "50.00", :y2 "20.00"}] [:line {:x1 "125.71", :y1 "280.00", :x2 "125.71", :y2 "20.00"}] [:line {:x1 "201.43", :y1 "280.00", :x2 "201.43", :y2 "20.00"}] [:line {:x1 "277.14", :y1 "280.00", :x2 "277.14", :y2 "20.00"}] [:line {:x1 "352.86", :y1 "280.00", :x2 "352.86", :y2 "20.00"}] [:line {:x1 "428.57", :y1 "280.00", :x2 "428.57", :y2 "20.00"}] [:line {:x1 "504.29", :y1 "280.00", :x2 "504.29", :y2 "20.00"}] [:line {:x1 "580.00", :y1 "280.00", :x2 "580.00", :y2 "20.00"}]) '([:line {:x1 "50.00", :y1 "262.53", :x2 "580.00", :y2 "262.53"}] [:line {:x1 "50.00", :y1 "227.58", :x2 "580.00", :y2 "227.58"}] [:line {:x1 "50.00", :y1 "192.63", :x2 "580.00", :y2 "192.63"}] [:line {:x1 "50.00", :y1 "157.69", :x2 "580.00", :y2 "157.69"}] [:line {:x1 "50.00", :y1 "122.74", :x2 "580.00", :y2 "122.74"}] [:line {:x1 "50.00", :y1 "87.80", :x2 "580.00", :y2 "87.80"}] [:line {:x1 "50.00", :y1 "52.85", :x2 "580.00", :y2 "52.85"}] [:line {:x1 "50.00", :y1 "280.00", :x2 "580.00", :y2 "280.00"}] [:line {:x1 "50.00", :y1 "245.05", :x2 "580.00", :y2 "245.05"}] [:line {:x1 "50.00", :y1 "210.11", :x2 "580.00", :y2 "210.11"}] [:line {:x1 "50.00", :y1 "175.16", :x2 "580.00", :y2 "175.16"}] [:line {:x1 "50.00", :y1 "140.22", :x2 "580.00", :y2 "140.22"}] [:line {:x1 "50.00", :y1 "105.27", :x2 "580.00", :y2 "105.27"}] [:line {:x1 "50.00", :y1 "70.32", :x2 "580.00", :y2 "70.32"}] [:line {:x1 "50.00", :y1 "35.38", :x2 "580.00", :y2 "35.38"}])] '([:g {:stroke "#3D325A", :stroke-width "19px"} [:line {:x1 "125.71", :y1 "129.73", :x2 "125.71", :y2 "280.00"}] [:line {:x1 "201.43", :y1 "129.73", :x2 "201.43", :y2 "280.00"}] [:line {:x1 "277.14", :y1 "115.75", :x2 "277.14", :y2 "280.00"}] [:line {:x1 "352.86", :y1 "91.29", :x2 "352.86", :y2 "280.00"}] [:line {:x1 "428.57", :y1 "80.81", :x2 "428.57", :y2 "280.00"}] [:line {:x1 "504.29", :y1 "63.33", :x2 "504.29", :y2 "280.00"}]]) [:g {:stroke "black"} '([:line {:x1 "50.00", :y1 "280.00", :x2 "50.00", :y2 "290.00"}] [:line {:x1 "125.71", :y1 "280.00", :x2 "125.71", :y2 "290.00"}] [:line {:x1 "201.43", :y1 "280.00", :x2 "201.43", :y2 "290.00"}] [:line {:x1 "277.14", :y1 "280.00", :x2 "277.14", :y2 "290.00"}] [:line {:x1 "352.86", :y1 "280.00", :x2 "352.86", :y2 "290.00"}] [:line {:x1 "428.57", :y1 "280.00", :x2 "428.57", :y2 "290.00"}] [:line {:x1 "504.29", :y1 "280.00", :x2 "504.29", :y2 "290.00"}] [:line {:x1 "580.00", :y1 "280.00", :x2 "580.00", :y2 "290.00"}]) '() [:g {:stroke "none", :fill "black", :font-family "Arial, sans-serif", :font-size 10, :text-anchor "middle"} [:text {:x "50.00", :y "300.00"} 1999] [:text {:x "125.71", :y "300.00"} 2000] [:text {:x "201.43", :y "300.00"} 2001] [:text {:x "277.14", :y "300.00"} 2002] [:text {:x "352.86", :y "300.00"} 2003] [:text {:x "428.57", :y "300.00"} 2004] [:text {:x "504.29", :y "300.00"} 2005] [:text {:x "580.00", :y "300.00"} 2006]] [:line {:x1 "50.00", :y1 "280.00", :x2 "580.00", :y2 "280.00"}]] [:g {:stroke "black"} '([:line {:x1 "50.00", :y1 "280.00", :x2 "40.00", :y2 "280.00"}] [:line {:x1 "50.00", :y1 "245.05", :x2 "40.00", :y2 "245.05"}] [:line {:x1 "50.00", :y1 "210.11", :x2 "40.00", :y2 "210.11"}] [:line {:x1 "50.00", :y1 "175.16", :x2 "40.00", :y2 "175.16"}] [:line {:x1 "50.00", :y1 "140.22", :x2 "40.00", :y2 "140.22"}] [:line {:x1 "50.00", :y1 "105.27", :x2 "40.00", :y2 "105.27"}] [:line {:x1 "50.00", :y1 "70.32", :x2 "40.00", :y2 "70.32"}] [:line {:x1 "50.00", :y1 "35.38", :x2 "40.00", :y2 "35.38"}]) '([:line {:x1 "50.00", :y1 "262.53", :x2 "45.00", :y2 "262.53"}] [:line {:x1 "50.00", :y1 "227.58", :x2 "45.00", :y2 "227.58"}] [:line {:x1 "50.00", :y1 "192.63", :x2 "45.00", :y2 "192.63"}] [:line {:x1 "50.00", :y1 "157.69", :x2 "45.00", :y2 "157.69"}] [:line {:x1 "50.00", :y1 "122.74", :x2 "45.00", :y2 "122.74"}] [:line {:x1 "50.00", :y1 "87.80", :x2 "45.00", :y2 "87.80"}] [:line {:x1 "50.00", :y1 "52.85", :x2 "45.00", :y2 "52.85"}]) [:g {:stroke "none", :fill "black", :font-family "Arial, sans-serif", :font-size 10, :text-anchor "end"} [:text {:x "35.00", :y "280.00"} "0.00"] [:text {:x "35.00", :y "245.05"} "10.00"] [:text {:x "35.00", :y "210.11"} "20.00"] [:text {:x "35.00", :y "175.16"} "30.00"] [:text {:x "35.00", :y "140.22"} "40.00"] [:text {:x "35.00", :y "105.27"} "50.00"] [:text {:x "35.00", :y "70.32"} "60.00"] [:text {:x "35.00", :y "35.38"} "70.00"]] [:line {:x1 "50.00", :y1 "280.00", :x2 "50.00", :y2 "20.00"}]]], :width 600, :height 320}))))
