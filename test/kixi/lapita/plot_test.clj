(ns kixi.lapita.plot-test
  (:require [kixi.lapita.plot :refer :all]
            [clojure.test :refer :all]
            [clojure.core.matrix.dataset :as ds]))

(def test-data
  (ds/dataset [{:col-1 2000 :col-2 43}
               {:col-1 2001 :col-2 47}
               {:col-1 2002 :col-2 62}
               {:col-1 2003 :col-2 43}
               {:col-1 2004 :col-2 54}
               {:col-1 2005 :col-2 57}]))

(def test-data2
  (ds/dataset [{:col-1 -10 :col-2 43}
               {:col-1 -5 :col-2 47}
               {:col-1 0 :col-2 62}
               {:col-1 5 :col-2 43}
               {:col-1 10 :col-2 54}
               {:col-1 15 :col-2 57}]))

(def test-data3
  (ds/dataset [{:col-1 33 :col-2 -15}
               {:col-1 47 :col-2 -10}
               {:col-1 52 :col-2 -5}
               {:col-1 58 :col-2 5}
               {:col-1 61 :col-2 10}
               {:col-1 67 :col-2 15}]))

(def test-data4
  (ds/dataset [{:col-1 1 :col-2 -15}
               {:col-1 2 :col-2 -10}
               {:col-1 3 :col-2 -5}
               {:col-1 4 :col-2 5}
               {:col-1 5 :col-2 10}
               {:col-1 6 :col-2 15}]))

(deftest bar-chart-test
  (testing "Creation of a basic bar chart"
    (is (= (bar-chart test-data :col-1 :col-2)
           {:plot [:g nil [:g {:stroke "#ccc", :stroke-dasharray "1 1"}
                           '([:line {:x1 "50.00", :y1 "280.00", :x2 "50.00", :y2 "20.00"}]
                             [:line {:x1 "125.71", :y1 "280.00", :x2 "125.71", :y2 "20.00"}]
                             [:line {:x1 "201.43", :y1 "280.00", :x2 "201.43", :y2 "20.00"}]
                             [:line {:x1 "277.14", :y1 "280.00", :x2 "277.14", :y2 "20.00"}]
                             [:line {:x1 "352.86", :y1 "280.00", :x2 "352.86", :y2 "20.00"}]
                             [:line {:x1 "428.57", :y1 "280.00", :x2 "428.57", :y2 "20.00"}]
                             [:line {:x1 "504.29", :y1 "280.00", :x2 "504.29", :y2 "20.00"}]
                             [:line {:x1 "580.00", :y1 "280.00", :x2 "580.00", :y2 "20.00"}])
                           '([:line {:x1 "50.00", :y1 "260.60", :x2 "580.00", :y2 "260.60"}]
                             [:line {:x1 "50.00", :y1 "221.79", :x2 "580.00", :y2 "221.79"}]
                             [:line {:x1 "50.00", :y1 "182.99", :x2 "580.00", :y2 "182.99"}]
                             [:line {:x1 "50.00", :y1 "144.18", :x2 "580.00", :y2 "144.18"}]
                             [:line {:x1 "50.00", :y1 "105.37", :x2 "580.00", :y2 "105.37"}]
                             [:line {:x1 "50.00", :y1 "66.57", :x2 "580.00", :y2 "66.57"}]
                             [:line {:x1 "50.00", :y1 "27.76", :x2 "580.00", :y2 "27.76"}]
                             [:line {:x1 "50.00", :y1 "280.00", :x2 "580.00", :y2 "280.00"}]
                             [:line {:x1 "50.00", :y1 "241.19", :x2 "580.00", :y2 "241.19"}]
                             [:line {:x1 "50.00", :y1 "202.39", :x2 "580.00", :y2 "202.39"}]
                             [:line {:x1 "50.00", :y1 "163.58", :x2 "580.00", :y2 "163.58"}]
                             [:line {:x1 "50.00", :y1 "124.78", :x2 "580.00", :y2 "124.78"}]
                             [:line {:x1 "50.00", :y1 "85.97", :x2 "580.00", :y2 "85.97"}]
                             [:line {:x1 "50.00", :y1 "47.16", :x2 "580.00", :y2 "47.16"}])]
                   '([:g {:stroke "#3D325A", :stroke-width "19px"}
                      [:line {:x1 "115.71", :y1 "113.13", :x2 "115.71", :y2 "280.00"}]
                      [:line {:x1 "191.43", :y1 "97.61", :x2 "191.43", :y2 "280.00"}]
                      [:line {:x1 "267.14", :y1 "39.40", :x2 "267.14", :y2 "280.00"}]
                      [:line {:x1 "342.86", :y1 "113.13", :x2 "342.86", :y2 "280.00"}]
                      [:line {:x1 "418.57", :y1 "70.45", :x2 "418.57", :y2 "280.00"}]
                      [:line {:x1 "494.29", :y1 "58.81", :x2 "494.29", :y2 "280.00"}]])
                   [:g {:stroke "black"}
                    '([:line {:x1 "50.00", :y1 "280.00", :x2 "50.00", :y2 "290.00"}]
                      [:line {:x1 "125.71", :y1 "280.00", :x2 "125.71", :y2 "290.00"}]
                      [:line {:x1 "201.43", :y1 "280.00", :x2 "201.43", :y2 "290.00"}]
                      [:line {:x1 "277.14", :y1 "280.00", :x2 "277.14", :y2 "290.00"}]
                      [:line {:x1 "352.86", :y1 "280.00", :x2 "352.86", :y2 "290.00"}]
                      [:line {:x1 "428.57", :y1 "280.00", :x2 "428.57", :y2 "290.00"}]
                      [:line {:x1 "504.29", :y1 "280.00", :x2 "504.29", :y2 "290.00"}]
                      [:line {:x1 "580.00", :y1 "280.00", :x2 "580.00", :y2 "290.00"}])
                    '()
                    [:g {:stroke "none", :fill "black", :font-family "Arial, sans-serif"
                         :font-size 10, :text-anchor "middle"}
                     [:text {:x "50.00", :y "300.00"} 1999] [:text {:x "125.71", :y "300.00"} 2000]
                     [:text {:x "201.43", :y "300.00"} 2001] [:text {:x "277.14", :y "300.00"} 2002]
                     [:text {:x "352.86", :y "300.00"} 2003] [:text {:x "428.57", :y "300.00"} 2004]
                     [:text {:x "504.29", :y "300.00"} 2005] [:text {:x "580.00", :y "300.00"} 2006]]
                    [:line {:x1 "50.00", :y1 "280.00", :x2 "580.00", :y2 "280.00"}]]
                   [:g {:stroke "black"}
                    '([:line {:x1 "270.00", :y1 "280.00", :x2 "260.00", :y2 "280.00"}]
                      [:line {:x1 "270.00", :y1 "241.19", :x2 "260.00", :y2 "241.19"}]
                      [:line {:x1 "270.00", :y1 "202.39", :x2 "260.00", :y2 "202.39"}]
                      [:line {:x1 "270.00", :y1 "163.58", :x2 "260.00", :y2 "163.58"}]
                      [:line {:x1 "270.00", :y1 "124.78", :x2 "260.00", :y2 "124.78"}]
                      [:line {:x1 "270.00", :y1 "85.97", :x2 "260.00", :y2 "85.97"}]
                      [:line {:x1 "270.00", :y1 "47.16", :x2 "260.00", :y2 "47.16"}])
                    '([:line {:x1 "270.00", :y1 "260.60", :x2 "265.00", :y2 "260.60"}]
                      [:line {:x1 "270.00", :y1 "221.79", :x2 "265.00", :y2 "221.79"}]
                      [:line {:x1 "270.00", :y1 "182.99", :x2 "265.00", :y2 "182.99"}]
                      [:line {:x1 "270.00", :y1 "144.18", :x2 "265.00", :y2 "144.18"}]
                      [:line {:x1 "270.00", :y1 "105.37", :x2 "265.00", :y2 "105.37"}]
                      [:line {:x1 "270.00", :y1 "66.57", :x2 "265.00", :y2 "66.57"}]
                      [:line {:x1 "270.00", :y1 "27.76", :x2 "265.00", :y2 "27.76"}])
                    [:g {:stroke "none", :fill "black", :font-family "Arial, sans-serif"
                         :font-size 10, :text-anchor "end"}
                     [:text {:x "255.00", :y "280.00"} "0.00"]
                     [:text {:x "255.00", :y "241.19"} "10.00"]
                     [:text {:x "255.00", :y "202.39"} "20.00"]
                     [:text {:x "255.00", :y "163.58"} "30.00"]
                     [:text {:x "255.00", :y "124.78"} "40.00"]
                     [:text {:x "255.00", :y "85.97"} "50.00"]
                     [:text {:x "255.00", :y "47.16"} "60.00"]]
                    [:line {:x1 "270.00", :y1 "280.00", :x2 "270.00", :y2 "20.00"}]]]
            :width 600, :height 320}))))
